name: Trunk

on:
  push:
    branches: [ trunk ]
  pull_request:
    branches: [ trunk ]

jobs:
  build:
    uses: ./.github/workflows/build.yaml
    with:
      environment: preview
      node_version: 16.x
      port: 8100
  deploy:
    environment: preview
    needs: build
    uses: ./.github/workflows/deploy.yml
    secrets:
      ssh-host: ${{ secrets.STAGING_SSH_HOST }}
      ssh-key: ${{ secrets.STAGING_SSH_KEY }}
      ssh-user: ${{ secrets.STAGING_SSH_USER }}
